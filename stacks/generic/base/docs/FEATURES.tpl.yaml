- id: "feature_notes_save"
  name: "Save Notes"
  module: "notes"
  tier: "core"
  stacks:
    - "flutter"
    - "python"
  description: "Allows an authenticated user to create, edit, and persist text notes with basic validation."
  entry_points:
    ui:
      - "Notes screen → New note"
      - "Note editor → Save"
    api:
      - "POST /api/notes"
      - "PUT /api/notes/{id}"
  preconditions:
    - "User is authenticated"
  postconditions_success:
    - "Note is persisted in primary store"
    - "Note appears in notes list"
  postconditions_failure:
    - "No partial writes committed"
    - "Validation errors returned"
  main_scenarios:
    - "Persist a valid note and return its id"
    - "Reject empty body"
    - "Require authentication"
  business_rules:
    - "Title optional, body required"
    - "Max length: 10000 characters"
    - "Notes are private to the owner"
  failure_modes:
    - code: "VALIDATION_ERROR"
      description: "Body is empty or exceeds max length"
    - code: "AUTH_REQUIRED"
      description: "Unauthenticated user attempts to save note"
    - code: "STORAGE_FAILURE"
      description: "Database error; note not persisted"
  permissions:
    allowed_roles:
      - "user"
      - "admin"
    denied_roles:
      - "suspended"
  side_effects:
    - "Emit 'note.saved' domain event"
  metrics:
    - name: "notes_saved_per_day"
      type: "counter"
    - name: "save_note_latency_ms_p95"
      type: "latency"
  linked_workflows:
    - "wf_onboarding_create_first_note"
